====================

====================
2025-02-16 14:42:24 - Configuration Samba valide.
====================
2025-02-16 14:42:24 - Arrêt et désactivation des services smbd, nmbd et winbind...
====================
Synchronizing state of smbd.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install disable smbd
Synchronizing state of nmbd.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install disable nmbd
Synchronizing state of winbind.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install disable winbind
Synchronizing state of samba-ad-dc.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install enable samba-ad-dc
2025-02-16 14:42:31 - Configuration du contrôleur de domaine Samba...
====================
lpcfg_load: refreshing parameters from /etc/samba/smb.conf
ERROR(<class 'samba.provision.ProvisioningError'>): Provision failed - ProvisioningError: guess_names: 'server role=standalone server' in /etc/samba/smb.conf must match chosen server role 'active directory domain controller'!  Please remove the smb.conf file and let provision generate it
  File "/usr/lib/python3/dist-packages/samba/netcmd/domain.py", line 493, in run
    result = provision(self.logger,
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3/dist-packages/samba/provision/__init__.py", line 2231, in provision
    names = guess_names(lp=lp, hostname=hostname, domain=domain,
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3/dist-packages/samba/provision/__init__.py", line 631, in guess_names
    raise ProvisioningError("guess_names: 'server role=%s' in %s must match chosen server role '%s'!  Please remove the smb.conf file and let provision generate it" % (lp.get("server role"), lp.configfile, serverrole))
2025-02-16 14:42:32 - Durcissement des configurations Samba...
====================
2025-02-16 14:42:32 - Génération de l'Autorité de Certification (CA) et des certificats TLS...
====================
genrsa: Can't open "/etc/samba/private/tls-ca.key" for writing, No such file or directory
Could not open file or uri for loading private key from /etc/samba/private/tls-ca.key
40E781B0C07F0000:error:16000069:STORE routines:ossl_store_get0_loader_int:unregistered scheme:../crypto/store/store_register.c:237:scheme=file
40E781B0C07F0000:error:80000002:system library:file_open:No such file or directory:../providers/implementations/storemgmt/file_store.c:267:calling stat(/etc/samba/private/tls-ca.key)
genrsa: Can't open "/etc/samba/private/tls.key" for writing, No such file or directory
Could not open file or uri for loading private key from /etc/samba/private/tls.key
40F71F0FFA7F0000:error:16000069:STORE routines:ossl_store_get0_loader_int:unregistered scheme:../crypto/store/store_register.c:237:scheme=file
40F71F0FFA7F0000:error:80000002:system library:file_open:No such file or directory:../providers/implementations/storemgmt/file_store.c:267:calling stat(/etc/samba/private/tls.key)
Can't open "/etc/samba/private/tls.csr" for reading, No such file or directory
40E72511EF7F0000:error:80000002:system library:BIO_new_file:No such file or directory:../crypto/bio/bss_file.c:67:calling fopen(/etc/samba/private/tls.csr, r)
40E72511EF7F0000:error:10000080:BIO routines:BIO_new_file:no such file:../crypto/bio/bss_file.c:75:
Unable to load certificate request input
chmod: impossible d'accéder à '/etc/samba/private/tls.*': Aucun fichier ou dossier de ce type
2025-02-16 14:42:32 - Certificats TLS générés et protégés.
====================
2025-02-16 14:42:32 - Redémarrage des services Samba...
====================
Synchronizing state of samba-ad-dc.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install enable samba-ad-dc
2025-02-16 14:42:34 - Test de la configuration Samba...
====================
